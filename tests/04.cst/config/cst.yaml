# Container Structure Tests for galeriadb image.
# Run via: tests/04.cst/entrypoint.sh [IMAGE]

schemaVersion: "2.0.0"

fileExistenceTests:
  - name: "entrypoint exists"
    path: "/usr/local/bin/entrypoint.sh"
    shouldExist: true
  - name: "galera-discovery exists"
    path: "/usr/local/bin/galera-discovery.sh"
    shouldExist: true
  - name: "galera-write-config exists"
    path: "/usr/local/bin/galera-write-config.sh"
    shouldExist: true
  - name: "galera-healthcheck exists"
    path: "/usr/local/bin/galera-healthcheck.sh"
    shouldExist: true
  - name: "galera-backup exists"
    path: "/usr/local/bin/galera-backup.sh"
    shouldExist: true
  - name: "galera-backup-setup exists"
    path: "/usr/local/bin/galera-backup-setup.sh"
    shouldExist: true
  - name: "galera-clone exists"
    path: "/usr/local/bin/galera-clone.sh"
    shouldExist: true
  - name: "galera config template exists"
    path: "/etc/mysql/conf.d/galera.cnf.template"
    shouldExist: true

fileContentTests:
  - name: "entrypoint is executable script"
    path: "/usr/local/bin/entrypoint.sh"
    expectedContents:
      - "#!/bin/bash"

commandTests:
  - name: "mariadb version"
    command: "mariadb"
    args: ["--version"]
    expectedOutput: ["MariaDB"]
    excludedOutput: []
  - name: "mysqld version"
    command: "mariadbd"
    args: ["--version"]
    expectedOutput: ["mariadbd"]
    excludedOutput: []

# v2 schema does not support exposedPortsTest/entrypointTest; ports and entrypoint
# are covered by file/command tests and by smoke/deploy tests.
