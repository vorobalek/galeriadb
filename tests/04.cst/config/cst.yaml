schemaVersion: "2.0.0"

fileExistenceTests:
  - name: "entrypoint exists"
    path: "/usr/local/bin/entrypoint.sh"
    shouldExist: true
  - name: "entrypoint lib exists"
    path: "/usr/local/bin/entrypoint-lib.sh"
    shouldExist: true
  - name: "entrypoint stages exist"
    path: "/usr/local/bin/entrypoint.d/00-env.sh"
    shouldExist: true
  - name: "entrypoint discovery stage exists"
    path: "/usr/local/bin/entrypoint.d/10-discovery.sh"
    shouldExist: true
  - name: "entrypoint write-config stage exists"
    path: "/usr/local/bin/entrypoint.d/20-write-config.sh"
    shouldExist: true
  - name: "entrypoint healthcheck stage exists"
    path: "/usr/local/bin/entrypoint.d/30-healthcheck.sh"
    shouldExist: true
  - name: "entrypoint init-or-clone stage exists"
    path: "/usr/local/bin/entrypoint.d/40-init-or-clone.sh"
    shouldExist: true
  - name: "entrypoint safe-to-bootstrap stage exists"
    path: "/usr/local/bin/entrypoint.d/50-safe-to-bootstrap.sh"
    shouldExist: true
  - name: "entrypoint start-mariadb stage exists"
    path: "/usr/local/bin/entrypoint.d/60-start-mariadb.sh"
    shouldExist: true
  - name: "entrypoint wait-ready stage exists"
    path: "/usr/local/bin/entrypoint.d/70-wait-ready.sh"
    shouldExist: true
  - name: "entrypoint ensure-root stage exists"
    path: "/usr/local/bin/entrypoint.d/80-ensure-root.sh"
    shouldExist: true
  - name: "entrypoint backup-cron stage exists"
    path: "/usr/local/bin/entrypoint.d/90-backup-cron.sh"
    shouldExist: true
  - name: "galera-healthcheck exists"
    path: "/usr/local/bin/galera-healthcheck.sh"
    shouldExist: true
  - name: "galera-backup exists"
    path: "/usr/local/bin/galera-backup.sh"
    shouldExist: true
  - name: "galera-clone exists"
    path: "/usr/local/bin/galera-clone.sh"
    shouldExist: true
  - name: "galera config template exists"
    path: "/etc/mysql/conf.d/galera.cnf.template"
    shouldExist: true

fileContentTests:
  - name: "entrypoint is executable script"
    path: "/usr/local/bin/entrypoint.sh"
    expectedContents:
      - "#!/bin/bash"

commandTests:
  - name: "mariadb version"
    command: "mariadb"
    args: ["--version"]
    expectedOutput: ["MariaDB"]
    excludedOutput: []
  - name: "mysqld version"
    command: "mariadbd"
    args: ["--version"]
    expectedOutput: ["mariadbd"]
    excludedOutput: []
